<html>
 <head>
   <link rel="stylesheet" href="style.css" />
   <script src="mustache.js"></script>
   <script src="FileSaver.min.js"></script>
  
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link href="css/bootstrap.min.css" rel="stylesheet" media="screen" />
 </head>
<body>
  <div class="container">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#" id="select_section_1">Section #1</a></li>
      <li><a href="#" id="select_section_2">Section #2</a></li>
      <li><a href="#" id="select_section_3">Section #3</a></li>
      <li><a href="#" id="select_section_4">Section #4</a></li>
    </ul>
   <div id='core' />
 
 </div>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
 </body>
 <script>


/* Rendering functions */
function render_sections()
{
  var view = {
    sections: []
  };
  for(var iSection=1; iSection<=4; iSection++) {
    var section = {
      categories: [],
      sectionIdx: iSection
    };
    for(var iCategory=1; iCategory<=6; iCategory++)
    {
      var category = {
        details: [],
        categoryIdx: iCategory
      };
      for(var iDetail=1; iDetail<=6; iDetail++)
      {
        category.details.push(iDetail);
      }
      section.categories.push(category);
    }
    
    view.sections.push(section);
  }
  
  return Mustache.render("{{#sections}}<div class='section' id='section{{sectionIdx}}'>" +
                             "<div class='sectionTitle row'>" +
                                 "<div class='span12'><input id='section{{sectionIdx}}' type='text' class='sectionTextInput' /></div>" +
                             "</div>" +
                             "{{#categories}}<div class='category'>" +
                                 "<div class='categoryTitle row'>" + 
                                     "<div class='span6'>" +
                                         "<img src='dice{{categoryIdx}}.png' class='categoryDice' />" +
                                         "<input id='sec{{sectionIdx}}_cat{{categoryIdx}}' type='text' class='categoryTextInput' />" +
                                     "</div>" +
                                     "<div class='span2'><a class='btn category_showhide' href='#'><i class='icon-chevron-down'></i>Hide</a></div>" +
                                 "</div>" +
                                 "{{#details}}<div class='categoryDetail row'>" +
                                     "<div class='span5 offset1'>" +
                                         "<img src='dice{{.}}.png' class='categoryDetailDice' />" + 
                                         "<input id='sec{{sectionIdx}}_cat{{categoryIdx}}_detail{{.}}' type='text' class='categoryDetailTextInput' />" +
                                     "</div>" +
                                 "</div>{{/details}}" +
                             "</div>{{/categories}}" +
                         "</div>{{/sections}}"
                         , view);
}

function click_section(sectionIdx)
{
  for(var iSection=1; iSection<=4; iSection++)
  {
    var sectionName = '#section' + iSection;
    var sectionTab = '#select_section_' + iSection;
    if (iSection == sectionIdx)
    {
      // Showing the section
      $(sectionName).show();
      $(sectionTab).parent().addClass('active');
    }
    else 
    {
      // Hiding the section
      $(sectionName).hide();
      $(sectionTab).parent().removeClass('active');
    }
  }
}

$(function() {
  $("#core").html(render_sections());
  
  for (var iSection = 1; iSection<=4; iSection++) {
        var selector = "#select_section_" + iSection;
        $(selector).on('click', {id: iSection}, function (e) {
            click_section(e.data.id);
        });
    }
  click_section(1);
  $('.category_showhide').click(function() {
    var isMasquer = $(this).children('i').hasClass('icon-chevron-down');
    if (isMasquer) {
        $(this).parent().parent().siblings('.categoryDetail').hide();
        $(this).html("<i class='icon-chevron-up'></i>Display");  
    } else {
        $(this).parent().parent().siblings('.categoryDetail').show();
        $(this).html("<i class='icon-chevron-down'></i>Hide");  
    }
    
  });
  
});
  </script>
</html>

