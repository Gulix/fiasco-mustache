<html>
 <head>
   <link rel="stylesheet" href="style.css" />
   <script src="mustache.js"></script>
   <script src="FileSaver.min.js"></script>
  
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link href="css/bootstrap.min.css" rel="stylesheet" media="screen" />
 </head>
<body>
  <div class="container">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#" id="select_section_0">Introduction</a></li>
      <li><a href="#" id="select_section_1">Section #1</a></li>
      <li><a href="#" id="select_section_2">Section #2</a></li>
      <li><a href="#" id="select_section_3">Section #3</a></li>
      <li><a href="#" id="select_section_4">Section #4</a></li>
      <li><a href="#" id="select_section_5">Insta-setup</a></li>
      <li><a href="#" id="select_section_90">Generate</a></li>
      <li><a href="#" id="select_section_99">About</a></li>
    </ul>
   <div id='core'>
     <!-- Sections 1 to 4 will be automatically generated by Mustache -->
     
     <!-- Generation by Mustache of the playset with the help of a template -->
     <div id='section90' class='section'>
        <div class='row'><p class='span12'>Mustache template to use for the generation</p></div>
        <div class='row'><div class='span10 offset1'><textarea style='width:100%' rows='15' placeholder='Mustache template' required></textarea></div></div>
        <div class='row'><button type="button" class="btn btn-primary offset8 span4">Generate !</button></div>
     </div>
   </div>
 
 </div>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
 </body>
 <script>


/* Rendering functions */
function render_sections()
{
  var view = {
    sections: []
  };
  for(var iSection=1; iSection<=4; iSection++) {
    var section = {
      categories: [],
      sectionIdx: iSection
    };
    for(var iCategory=1; iCategory<=6; iCategory++)
    {
      var category = {
        details: [],
        categoryIdx: iCategory
      };
      for(var iDetail=1; iDetail<=6; iDetail++)
      {
        category.details.push(iDetail);
      }
      section.categories.push(category);
    }
    
    view.sections.push(section);
  }
  
  // Render the four "dice" sections, all the same
  return Mustache.render("{{#sections}}<div class='section' id='section{{sectionIdx}}'>" +
                             "<div class='sectionTitle row'>" +
                                 "<div class='span12'><input id='section{{sectionIdx}}' type='text' class='sectionTextInput' /></div>" +
                             "</div>" +
                             "{{#categories}}<div class='category'>" +
                                 "<div class='categoryTitle row'>" + 
                                     "<div class='span6'>" +
                                         "<img src='dice{{categoryIdx}}.png' class='categoryDice' />" +
                                         "<input id='sec{{sectionIdx}}_cat{{categoryIdx}}' type='text' class='categoryTextInput' />" +
                                     "</div>" +
                                     "<div class='span2'><a class='btn category_showhide' href='#'><i class='icon-chevron-up'></i>Hide</a></div>" +
                                 "</div>" +
                                 "{{#details}}<div class='categoryDetail row'>" +
                                     "<div class='span5 offset1'>" +
                                         "<img src='dice{{.}}.png' class='categoryDetailDice' />" + 
                                         "<input id='sec{{sectionIdx}}_cat{{categoryIdx}}_detail{{.}}' type='text' class='categoryDetailTextInput' />" +
                                     "</div>" +
                                 "</div>{{/details}}" +
                             "</div>{{/categories}}" +
                         "</div>{{/sections}}"
                         , view);
}

function click_section(sectionIdx)
{
  var lsIdx = [0, 1, 2, 3, 4, 5, 90, 99];
  for(var idx=0; idx<=lsIdx.length; idx++)
  {
    var sectionName = '#section' + lsIdx[idx];
    var sectionTab = '#select_section_' + lsIdx[idx];
    if (lsIdx[idx] == sectionIdx)
    {
      // Showing the section
      $(sectionName).show();
      $(sectionTab).parent().addClass('active');
    }
    else 
    {
      // Hiding the section
      $(sectionName).hide();
      $(sectionTab).parent().removeClass('active');
    }
  }
}

$(function() {
  $("#core").append(render_sections());
  
  // Click events on the sections
  var lsIdx = [0, 1, 2, 3, 4, 5, 90, 99];
  for(var idx=0; idx<=lsIdx.length; idx++) {    
        var selector = "#select_section_" + lsIdx[idx];
        $(selector).on('click', {id: lsIdx[idx]}, function (e) {
            click_section(e.data.id);
        });
    }
  click_section(0);
  $('.category_showhide').click(function() {
    var isMasquer = $(this).children('i').hasClass('icon-chevron-up');
    if (isMasquer) {
        $(this).parent().parent().siblings('.categoryDetail').hide();
        $(this).html("<i class='icon-chevron-down'></i>Display");  
    } else {
        $(this).parent().parent().siblings('.categoryDetail').show();
        $(this).html("<i class='icon-chevron-up'></i>Hide");  
    }
    
  });
  
});
  </script>
</html>

